# Cloud Setup to Jupyter: Step-by-Step Checklist

This document walks you through getting FMR data into Railway cloud and then using Jupyter to explore it.

## Prerequisites

- âœ… Railway account (you have this linked to GitHub)
- âœ… `fmr_data.json` file (generated by `explore_fmr.py`)
- âœ… All code committed to GitHub (already done)

---

## Phase 1: Set Up PostgreSQL on Railway

### 1.1 Create PostgreSQL Database

1. Go to https://railway.app/dashboard
2. Click "New Project"
3. Click "Add service"
4. Select "PostgreSQL"
5. Railway creates a PostgreSQL instance
6. **Wait for it to finish provisioning** (watch the dashboard)

### 1.2 Get Connection String

1. In Railway dashboard, click on the PostgreSQL service
2. Go to "Connect" tab
3. Copy the **PostgreSQL URI** (entire string)
4. It looks like: `postgresql://user:password@host:port/database`
5. **Save this somewhere** - you'll need it for the next steps

**Or get individual values:**

- Go to "Variables" tab
- Note: PGHOST, PGPORT, PGUSER, PGPASSWORD, PGDATABASE

### 1.3 Verify Connection

```bash
# Test that you can connect (replace with your actual string)
export DATABASE_URL="[postgresql://user:password@host:port/database](postgresql://postgres:mcazwRDPTQRoPjTIdcEWPvLHsbjMEEDK@maglev.proxy.rlwy.net:27498/railway)"

# Using psql (if installed)
psql $DATABASE_URL -c "SELECT 1"

# Or using Docker
docker run --rm postgres:16 psql $DATABASE_URL -c "SELECT 1"

# Success = "1" is printed
```

---

## Phase 2: Create Database Schema on Railway

### 2.1 Upload Schema

You have two options:

**Option A: Using psql from your machine**

```bash
export DATABASE_URL="postgresql://user:password@host:port/database"
psql $DATABASE_URL < backend/db/init.sql
```

**Option B: Via Railway Shell**

1. In Railway dashboard, click PostgreSQL service
2. Click "Shell" tab
3. Copy contents of `backend/db/init.sql`
4. Paste into the shell
5. Run

### 2.2 Verify Schema Created

```bash
# Check tables exist
psql $DATABASE_URL -c "\dt"

# Should show:
# aggregations | table
# areas        | table
# rents        | table
```

If tables don't show, schema creation failed. Check the error message.

---

## Phase 3: Load FMR Data to Railway

### 3.1 Install Python Dependencies

```bash
pip install psycopg2-binary python-dotenv
```

### 3.2 Run Data Loader

```bash
# Set environment variable
export DATABASE_URL="postgresql://user:password@host:port/database"

# Run the loader
python3 backend/scripts/load_fmr_data.py
```

This script will:

- Read `fmr_data.json`
- Connect to Railway PostgreSQL
- Insert all 5,449 areas
- Insert rent data
- Show success/failure

**Expected output:**

```
====================================================
FMR Data Loader
====================================================
ðŸ“– Reading fmr_data.json...
âœ… Loaded 5449 areas from JSON
ðŸ”Œ Connecting to PostgreSQL...

ðŸ“Š Inserting areas...
   âœ… Inserted 5449 areas
ðŸ“Š Inserting rents...
   âœ… Inserted 5449 rent records

âœ… Verifying data...
   Areas: 5,449
   Rents: 5,449

   2-Bedroom Rent Statistics:
     Min: $473
     Max: $4,054
     Avg: $1,214

âœ… Data loaded successfully!
```

### 3.3 Verify Data Loaded

```bash
# Check row counts
psql $DATABASE_URL -c "SELECT COUNT(*) FROM areas;"
# Should return: 5449

# Check a specific state
psql $DATABASE_URL -c "SELECT COUNT(*) FROM areas WHERE state='CA';"
# Should return: ~90

# Test pivot view
psql $DATABASE_URL -c "SELECT * FROM pivot_by_state_type WHERE state='CA' LIMIT 3;"
# Should return metro and county aggregations for CA
```

---

## Phase 4: Set Up Jupyter Locally

### 4.1 Install Jupyter and Dependencies

```bash
pip install jupyter pandas psycopg2-binary sqlalchemy matplotlib seaborn
```

### 4.2 Save Connection String

Create a `.env` file in the project root:

```bash
DATABASE_URL=postgresql://user:password@host:port/database
```

Or you can hardcode it in the notebook (less secure, but fine for local exploration).

### 4.3 Start Jupyter

```bash
jupyter notebook
```

This opens http://localhost:8888 in your browser.

### 4.4 Open Example Notebook

1. In Jupyter browser window, navigate to `notebooks/`
2. Click on `01_fmr_exploration.ipynb`
3. In the second cell, update `DATABASE_URL` with your Railway connection string
4. Run the cells!

**Or create a new notebook:**

1. Click "New" â†’ "Python 3"
2. Copy code from `JUPYTER_SETUP.md`
3. Update `DATABASE_URL`
4. Start exploring

---

## Phase 5: Explore Your Data!

Use the example queries in the Jupyter notebook to:

- View overall statistics
- Find most/least expensive areas
- Analyze by state and type
- Create visualizations
- Build custom queries

See `JUPYTER_SETUP.md` for more examples.

---

## Troubleshooting

### Connection fails

```bash
# 1. Double-check your connection string
# Go to Railway dashboard â†’ PostgreSQL â†’ Connect
# Copy the entire URI again

# 2. Test connection
psql "postgresql://user:password@host:port/database" -c "SELECT 1"

# 3. Check Railway PostgreSQL is running
# In Railway dashboard, check the PostgreSQL service status
```

### "schema "public" does not exist"

```bash
# Schema wasn't created. Run:
psql $DATABASE_URL < backend/db/init.sql

# Or create manually via Railway Shell
```

### "ERROR: relation "areas" does not exist"

```bash
# Tables not created. Verify:
psql $DATABASE_URL -c "\dt"

# If no tables shown, re-run schema creation (step 2.1)
```

### "ERROR: duplicate key value violates unique constraint"

```bash
# Data was already partially loaded
# Drop and reload:
psql $DATABASE_URL -c "DROP TABLE IF EXISTS rents CASCADE; DROP TABLE IF EXISTS areas CASCADE;"
psql $DATABASE_URL < backend/db/init.sql
python3 backend/scripts/load_fmr_data.py
```

### psql command not found

```bash
# Install PostgreSQL client tools:
# macOS: brew install postgresql
# Ubuntu: sudo apt-get install postgresql-client
# Or use Docker: docker run --rm postgres:16 psql $DATABASE_URL -c "SELECT 1"
```

### Jupyter won't start

```bash
# Check if port 8888 is in use
# Try different port: jupyter notebook --port 8889

# Or check for errors:
jupyter --version
python --version  # Should be 3.8+
```

---

## Quick Reference

| Step            | Command                                               |
| --------------- | ----------------------------------------------------- |
| Set DB URL      | `export DATABASE_URL="..."`                           |
| Test connection | `psql $DATABASE_URL -c "SELECT 1"`                    |
| Create schema   | `psql $DATABASE_URL < backend/db/init.sql`            |
| Load data       | `python3 backend/scripts/load_fmr_data.py`            |
| Verify data     | `psql $DATABASE_URL -c "SELECT COUNT(*) FROM areas;"` |
| Start Jupyter   | `jupyter notebook`                                    |
| Open notebook   | http://localhost:8888                                 |

---

## Success Criteria âœ…

- [ ] PostgreSQL running on Railway
- [ ] Schema created (3 tables exist)
- [ ] 5,449 areas loaded
- [ ] 5,449 rent records loaded
- [ ] Queries return correct data
- [ ] Jupyter starts
- [ ] Jupyter connects to Railway database
- [ ] Example notebook runs without errors
- [ ] Visualizations display
- [ ] Ready to explore and integrate additional data

---

## Next Steps After Jupyter

Once you're comfortable with the data:

1. Explore multi-dataset integration ideas (Census, BLS, etc.)
2. Document interesting findings
3. Design schema updates for new data sources
4. Return to Next.js/Railway for production UI
5. Deploy full application

---

## Contact Points

If stuck at any step:

1. Check "Troubleshooting" section above
2. Review `RAILWAY_SETUP.md` for detailed Railway instructions
3. Review `JUPYTER_SETUP.md` for Jupyter query examples
4. Check Railway dashboard logs
5. Check Jupyter error messages
